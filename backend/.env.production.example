# =============================================================================
# PIXCRAWLER BACKEND PRODUCTION ENVIRONMENT CONFIGURATION
# =============================================================================
# This file contains REQUIRED production configuration for the FastAPI application.
# Copy this file to .env.production and update with your production values.
# 
# IMPORTANT: All Redis, Celery, Azure, and rate limiting configurations are
# MANDATORY in production. The application will fail to start if these are not
# properly configured.
# =============================================================================

# -----------------------------------------------------------------------------
# Application Settings (REQUIRED)
# -----------------------------------------------------------------------------
# Environment mode - MUST be 'production'
ENVIRONMENT=production

# Disable debug mode in production
DEBUG=false

# Server configuration
HOST=0.0.0.0
PORT=8000

# Logging level
LOG_LEVEL=INFO

# -----------------------------------------------------------------------------
# Supabase Configuration (REQUIRED)
# -----------------------------------------------------------------------------
# Get these values from: https://app.supabase.com/project/_/settings/api

# Supabase project URL (REQUIRED)
SUPABASE_URL=https://your-project.supabase.co

# Service role key (REQUIRED - bypasses RLS, use for backend admin operations)
# Security: Keep this secret! Never expose to browser!
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-here

# Anonymous key (REQUIRED - for frontend, respects RLS)
SUPABASE_ANON_KEY=your-anon-key-here

# -----------------------------------------------------------------------------
# CORS Configuration (REQUIRED)
# -----------------------------------------------------------------------------
# Comma-separated list of allowed origins
# Update with your actual frontend URL(s)
ALLOWED_ORIGINS=https://your-frontend-domain.com,https://www.your-frontend-domain.com

# -----------------------------------------------------------------------------
# Database Configuration (REQUIRED)
# -----------------------------------------------------------------------------
# PostgreSQL connection URL (asyncpg driver for async support)
# Format: postgresql+asyncpg://user:password@host:port/database
DATABASE_URL=postgresql+asyncpg://postgres:password@db.your-project.supabase.co:5432/postgres

# Connection pool settings
DATABASE_POOL_SIZE=10
DATABASE_MAX_OVERFLOW=20

# -----------------------------------------------------------------------------
# Redis Configuration (REQUIRED IN PRODUCTION)
# -----------------------------------------------------------------------------
# Redis connection URL - MUST NOT be localhost in production
# Use managed Redis service (Azure Cache for Redis, AWS ElastiCache, etc.)
REDIS_URL=redis://your-redis-server:6379/0

# Cache expiration time in seconds
REDIS_EXPIRE_SECONDS=3600

# -----------------------------------------------------------------------------
# Celery Configuration (REQUIRED IN PRODUCTION)
# -----------------------------------------------------------------------------
# Celery broker URL - MUST NOT be localhost in production
# Use managed Redis or RabbitMQ service
CELERY_BROKER_URL=redis://your-redis-server:6379/1

# Celery result backend URL - MUST NOT be localhost in production
CELERY_RESULT_BACKEND=redis://your-redis-server:6379/2

# -----------------------------------------------------------------------------
# Cache Configuration (REQUIRED IN PRODUCTION)
# -----------------------------------------------------------------------------
# Enable caching - MUST be true in production for performance
CACHE_ENABLED=true

# Redis host for caching - MUST NOT be localhost in production
CACHE_REDIS_HOST=your-redis-server
CACHE_REDIS_PORT=6379
CACHE_REDIS_PASSWORD=your-redis-password-if-any
CACHE_REDIS_DB=0
CACHE_PREFIX=pixcrawler:cache:
CACHE_DEFAULT_TTL=3600

# -----------------------------------------------------------------------------
# Rate Limiting Configuration (REQUIRED IN PRODUCTION)
# -----------------------------------------------------------------------------
# Enable rate limiting - MUST be true in production for API protection
LIMITER_ENABLED=true

# Redis host for rate limiting - MUST NOT be localhost in production
LIMITER_REDIS_HOST=your-redis-server
LIMITER_REDIS_PORT=6379
LIMITER_REDIS_PASSWORD=your-redis-password-if-any
LIMITER_REDIS_DB=1
LIMITER_PREFIX=pixcrawler:limiter:
LIMITER_DEFAULT_TIMES=100
LIMITER_DEFAULT_SECONDS=60

# -----------------------------------------------------------------------------
# Storage Provider Configuration
# -----------------------------------------------------------------------------
# Storage provider (local, azure)
# Use 'azure' for production
STORAGE_PROVIDER=azure

# -----------------------------------------------------------------------------
# Azure Blob Storage Configuration (REQUIRED IF STORAGE_PROVIDER=azure)
# -----------------------------------------------------------------------------
# Azure storage connection string (REQUIRED for Azure storage)
# Get from: Azure Portal → Storage Account → Access Keys
STORAGE_AZURE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=YOUR_ACCOUNT;AccountKey=YOUR_KEY;EndpointSuffix=core.windows.net

# OR use account name and key separately:
# AZURE_BLOB_ACCOUNT_NAME=your-storage-account-name
# AZURE_BLOB_ACCOUNT_KEY=your-storage-account-key

# Azure container name
STORAGE_AZURE_CONTAINER_NAME=pixcrawler-storage

# Azure storage settings
STORAGE_AZURE_MAX_RETRIES=3
STORAGE_AZURE_ENABLE_ARCHIVE_TIER=true
STORAGE_AZURE_DEFAULT_TIER=hot
STORAGE_AZURE_REHYDRATE_PRIORITY=standard

# -----------------------------------------------------------------------------
# Azure Lifecycle Management (Optional)
# -----------------------------------------------------------------------------
STORAGE_AZURE_LIFECYCLE_ENABLED=true
STORAGE_AZURE_LIFECYCLE_COOL_AFTER_DAYS=30
STORAGE_AZURE_LIFECYCLE_ARCHIVE_AFTER_DAYS=90
STORAGE_AZURE_LIFECYCLE_DELETE_AFTER_DAYS=2555

# -----------------------------------------------------------------------------
# Azure Application Insights (Optional but Recommended)
# -----------------------------------------------------------------------------
# Enable Application Insights for monitoring
AZURE_MONITOR_ENABLED=true
AZURE_MONITOR_CONNECTION_STRING=InstrumentationKey=your-key;IngestionEndpoint=https://...
AZURE_MONITOR_SAMPLING_RATE=1.0
AZURE_MONITOR_LOG_LEVEL=WARNING

# -----------------------------------------------------------------------------
# File Upload Configuration
# -----------------------------------------------------------------------------
UPLOAD_MAX_SIZE=10485760
UPLOAD_ALLOWED_EXTENSIONS=.jpg,.jpeg,.png,.gif,.webp

# =============================================================================
# PRODUCTION CHECKLIST
# =============================================================================
# Before deploying to production, ensure:
# 
# ✅ ENVIRONMENT=production
# ✅ DEBUG=false
# ✅ All Redis URLs point to managed Redis service (NOT localhost)
# ✅ CACHE_ENABLED=true
# ✅ LIMITER_ENABLED=true
# ✅ Azure Blob Storage configured if STORAGE_PROVIDER=azure
# ✅ CORS origins set to actual frontend domain(s)
# ✅ All secrets are properly secured (use Azure Key Vault in production)
# ✅ Database connection uses SSL/TLS
# ✅ Redis connections use authentication
# 
# =============================================================================
